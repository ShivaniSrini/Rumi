<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Your Habits</title>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background-color: #F5F1EA;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #8FAA9D;
      color: white;
      padding: 20px 40px;
      text-align: center;
      font-size: 28px;
      letter-spacing: 1px;
    }
    main {
      padding: 40px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 25px;
    }
    .habit-card {
      background-color: #FAF7F2;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .habit-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 10px rgba(0,0,0,0.15);
    }
    .habit-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
    }
    .habit-title {
      font-size: 20px;
      font-weight: 700;
      color: #5D7E6D;
    }
    .habit-icons {
      display: flex;
      gap: 10px;
    }
    .habit-icons button {
      background: none;
      border: none;
      color: #6D8E7A;
      cursor: pointer;
      font-size: 18px;
      transition: color 0.2s;
    }
    .habit-icons button:hover {
      color: #4C6E5A;
    }
    .habit-desc {
      margin-top: 10px;
      color: #555;
      line-height: 1.4;
    }
    .habit-duration {
      margin-top: 14px;
      font-weight: 600;
      color: #7B9478;
    }

    /* Modals â€” identical look to dashboard */
    .modal {
      display: none;
      position: fixed;
      z-index: 5;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.3);
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background-color: #FAF7F2;
      border-radius: 12px;
      width: 380px;
      padding: 30px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      text-align: left;
    }
    label { display: block; margin-top: 15px; font-weight: 600; color: #5D7E6D; }
    input, textarea, select {
      width: 100%;
      margin-top: 6px;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #B4C6A6;
      background: #ffffff;
      box-sizing: border-box;
      font-family: inherit;
    }
    .form-actions {
      margin-top: 25px;
      text-align: right;
    }
    .form-actions button {
      background: #8FAA9D;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 8px;
      cursor: pointer;
      margin-left: 10px;
    }
    .form-actions button.cancel {
      background: #B4C6A6;
    }
  </style>
</head>
<body>
  <header>Habits</header>
  <main>
    <div class="habit-card" th:each="habit : ${habits}">
      <div class="habit-header">
        <div class="habit-title" th:text="${habit.title}">Habit Title</div>
        <div class="habit-icons">
          <button type="button"
                  th:attr="data-id=${habit.id},data-title=${habit.title},data-description=${habit.description},data-hours=${habit.hours},data-minutes=${habit.minutes}"
                  onclick="openEditModal(this)">
            <i class="fa-solid fa-pen"></i>
          </button>
          <button type="button"
                  th:attr="data-id=${habit.id}"
                  onclick="openDeleteModal(this)">
            <i class="fa-solid fa-trash"></i>
          </button>
        </div>
      </div>
      <div class="habit-desc" th:text="${habit.description}">Description...</div>
      <div class="habit-duration">
        Duration: <span th:text="${habit.hours}">1</span>h <span th:text="${habit.minutes}">30</span>m
      </div>
    </div>
  </main>

  <!-- edit modal -->
  <div class="modal" id="editModal">
    <div class="modal-content">
      <h2>Edit Habit</h2>
      <form th:action="@{/habits/save}" method="post">
        <input type="hidden" id="editId" name="id">

        <label>Title</label>
        <input type="text" id="editTitle" name="title" required>

        <label>Description</label>
        <textarea id="editDescription" name="description" rows="3" required></textarea>

        <label>Duration</label>
        <div style="display: flex; gap: 10px;">
          <select id="editHours" name="hours" required></select>
          <select id="editMinutes" name="minutes" required></select>
        </div>

        <div class="form-actions">
          <button type="button" class="cancel" onclick="closeEditModal()">Cancel</button>
          <button type="submit">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- delete confirmation -->
  <div class="modal" id="deleteModal">
    <div class="modal-content">
      <h2>Confirm Deletion</h2>
      <p>Are you sure you want to delete this habit?</p>
      <div class="form-actions">
        <button type="button" class="cancel" onclick="closeDeleteModal()">Cancel</button>
        <a id="confirmDelete" style="text-decoration: none;">
          <button type="button">Delete</button>
        </a>
      </div>
    </div>
  </div>

  <script>
    // hr/min selects populated once only
    document.addEventListener('DOMContentLoaded', () => {
      const hourSelect = document.getElementById('editHours');
      const minuteSelect = document.getElementById('editMinutes');
      for (let i = 0; i <= 12; i++) {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = `${i} hour${i !== 1 ? 's' : ''}`;
        hourSelect.appendChild(opt);
      }
      for (let i = 0; i < 60; i += 15) {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = `${i} min`;
        minuteSelect.appendChild(opt);
      }
    });

    // edit modal
    function openEditModal(btn) {
      document.getElementById('editId').value = btn.getAttribute('data-id');
      document.getElementById('editTitle').value = btn.getAttribute('data-title');
      document.getElementById('editDescription').value = btn.getAttribute('data-description');

      const hours = btn.getAttribute('data-hours');
      const minutes = btn.getAttribute('data-minutes');
      document.getElementById('editHours').value = hours;
      document.getElementById('editMinutes').value = minutes;

      document.getElementById('editModal').style.display = 'flex';
    }
    function closeEditModal() {
      document.getElementById('editModal').style.display = 'none';
    }

    // delete modal
    function openDeleteModal(btn) {
      const id = btn.getAttribute('data-id');
      document.getElementById('confirmDelete').setAttribute('href', '/habits/delete/' + id);
      document.getElementById('deleteModal').style.display = 'flex';
    }
    function closeDeleteModal() {
      document.getElementById('deleteModal').style.display = 'none';
    }

    // modals close user clicks outside of them
    window.onclick = e => {
      const editModal = document.getElementById('editModal');
      const deleteModal = document.getElementById('deleteModal');
      if (e.target === editModal) editModal.style.display = 'none';
      if (e.target === deleteModal) deleteModal.style.display = 'none';
    };
  </script>
</body>
</html>

